{{define "title"}}Roster{{end}}
{{define "head"}}
	{{JS "/static/js/vue.min.js"}}
	{{JS "/static/js/vue-resource.min.js"}}
{{end}}
{{define "content"}}
<div id="roster">
	<div class="page-header cloud">
		<a v-for="dfg in groups" v-bind:href="'#' + dfg.Name">[ ${dfg.Desc} ]</a>
	</div>

	<div v-for="dfg in groups" class="panel panel-default">
		<div class="panel-heading" :id="dfg.Name">
			<h3 class="panel-title">${dfg.Desc}
				<span v-if="dfg.Squads" class="badge" title="Count of Squads in DFG">${dfg.SquadsSz}</span>
			</h3>
		</div>
		<div class="panel-body">

			<!-- Group Core Info -->
			<div class="dfg-details">
				<a v-if="dfg.Backlog" :href="dfg.Backlog">[ Backlog ]</a>
				<a v-if="dfg.Mission" :href="dfg.Mission">[ Mission ]</a>
			</div>
			<div class="dfg-core">
				<div v-if="dfg.PMs" class="dfg-core pm">
					Product Management: <a v-for="PM in dfg.PMs" :href="'https://rover.redhat.com/people/profile/' + PM.UID + '/'">[ ${PM.UID} ]</a>
				</div>
				<div v-if="dfg.Stewards" class="dfg-core stewards">
					Stewards: <a v-for="Steward in dfg.Stewards" :href="'https://rover.redhat.com/people/profile/' + Steward.UID + '/'">[ ${Steward.UID} ]</a>
				</div>
			</div>

			<!-- Group Details -->
			<button v-on:click="showDetails(dfg.Name)" class="btn btn-default pull-right" type="button">Details</button>
			<keep-alive>
				<component v-if="active == dfg.Name" :is="current"></component>
			</keep-alive>

		</div>
	</div>
</div>

<template id="details">
	<div>
		<h3>tada: ${this.$parent.active}</h3>
		<h2>some is ${members}</h2>
	</div>
</template>

<script type="text/javascript">
	Vue.component('groupDetails', {
		delimiters: ['${', '}'],
		template: "#details",
		data: function () {
			return {
				 members: []
			}
		},
		mounted: function () {
			this.$http.get('/roster/v1/members/'+this.$parent.active).then(function(response) {
				this.members = response.body
			})
		}
	})

	let roster = new Vue({
		el: '#roster',
		delimiters: ['${', '}'],
		data: {
			groups: [],
			current: "groupDetails",
			active: ""
		},
		mounted: function() {
			this.$http.get('/roster/v1/groups').then(function(response) {
				this.groups = response.body
			})
		},
		methods: {
			showDetails: function (group) {
				this.active = group
			},
		}
	});
</script>
	{{template "footer" .}}
{{end}}
{{define "foot"}}{{end}}